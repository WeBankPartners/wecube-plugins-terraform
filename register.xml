<?xml version="1.0" encoding="UTF-8"?>
<package name="terraform" version="{{PLUGIN_VERSION}}">

    <!-- 1.依赖分析 - 描述运行本插件包需要的其他插件包 -->
    <packageDependencies>
        <packageDependency name="platform" version="v2.7.0" />
    </packageDependencies>

    <!-- 2.菜单注入 - 描述运行本插件包需要注入的菜单 -->
    <menus>
        <menu code='ADMIN_TERRAFORM_CONFIG' cat='ADMIN' displayName="Terraform" localDisplayName="Terraform配置管理">/terraformIndex</menu>
    </menus>

    <!-- 3.数据模型 - 描述本插件包的数据模型,并且描述和Framework数据模型的关系 -->
    <dataModel>
    </dataModel>

    <!-- 4.系统参数 - 描述运行本插件包需要的系统参数 -->
    <systemParameters>
    </systemParameters>


    <!-- 5.权限设定 -->
    <authorities>
        <authority systemRoleName="SUPER_ADMIN" >
            <menu code="ADMIN_TERRAFORM_CONFIG" />
        </authority >
    </authorities>

    <!-- 6.运行资源 - 描述部署运行本插件包需要的基础资源(如主机、虚拟机、容器、数据库等) -->
    <resourceDependencies>
        <docker imageName="{{IMAGENAME}}" containerName="{{CONTAINERNAME}}"
        portBindings="{{ALLOCATE_PORT}}:8999"
        volumeBindings="{{BASE_MOUNT_PATH}}/certs:/data,/etc/localtime:/etc/localtime,{{BASE_MOUNT_PATH}}/terraform/logs:/app/wecube_plugins_terraform/logs,{{BASE_MOUNT_PATH}}/terraform/terraform:/app/wecube_plugins_terraform/terraform"
        envVariables="MYSQL_USERNAME={{DB_USER}},MYSQL_PASSWORD={{DB_PWD}},
        MYSQL_HOST={{DB_HOST}},MYSQL_PORT={{DB_PORT}},MYSQL_DATABASE={{DB_SCHEMA}},
        JWT_SIGNING_KEY={{JWT_SIGNING_KEY}}"/>
        <mysql schema="terraform" initFileName="init.sql"/>
    </resourceDependencies>

    <!-- 7.插件列表 - 描述插件包中单个插件的输入和输出 -->
    <plugins>
        <plugin name="vpc">
            <interface action="create" path="/terraform/v1/network/backend/vpc/create" httpMethod='POST'>
                <inputParameters>
                    <parameter datatype="string" mappingType="entity" required="N">id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">provider_id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">region</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">zone</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">cidr</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">result</parameter>
                    <parameter datatype="string">errorMessage</parameter>
                    <parameter datatype="string">errorCode</parameter>
                </outputParameters>
            </interface>
            <interface action="delete" path="/terraform/v1/network/backend/vpc/delete" httpMethod='POST'>
                <inputParameters>
                    <parameter datatype="string" mappingType="entity" required="Y">id</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">result</parameter>
                    <parameter datatype="string">errorMessage</parameter>
                    <parameter datatype="string">errorCode</parameter>
                </outputParameters>
            </interface>
        </plugin>
        <plugin name="subnet">
            <interface action="create" path="/terraform/v1/network/backend/subnet/create" httpMethod='POST'>
                <inputParameters>
                    <parameter datatype="string" mappingType="entity" required="N">id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">name</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">provider_id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">region</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">zone</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">cidr</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">vpc_id</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">result</parameter>
                    <parameter datatype="string">errorMessage</parameter>
                    <parameter datatype="string">errorCode</parameter>
                </outputParameters>
            </interface>
            <interface action="delete" path="/terraform/v1/network/backend/subnet/delete" httpMethod='POST'>
                <inputParameters>
                    <parameter datatype="string" mappingType="entity" required="Y">id</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">result</parameter>
                    <parameter datatype="string">errorMessage</parameter>
                    <parameter datatype="string">errorCode</parameter>
                </outputParameters>
            </interface>
        </plugin>
        <plugin name="route_table">
            <interface action="create" path="/terraform/v1/network/backend/route_table/create" httpMethod='POST'>
                <inputParameters>
                    <parameter datatype="string" mappingType="entity" required="N">id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">name</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">provider_id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">region</parameter>
                    <parameter datatype="string" mappingType="entity" required="N">zone</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">vpc_id</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">result</parameter>
                    <parameter datatype="string">errorMessage</parameter>
                    <parameter datatype="string">errorCode</parameter>
                </outputParameters>
            </interface>
            <interface action="delete" path="/terraform/v1/network/backend/route_table/delete" httpMethod='POST'>
                <inputParameters>
                    <parameter datatype="string" mappingType="entity" required="Y">id</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">result</parameter>
                    <parameter datatype="string">errorMessage</parameter>
                    <parameter datatype="string">errorCode</parameter>
                </outputParameters>
            </interface>
        </plugin>
        <plugin name="route_entry">
            <interface action="create" path="/terraform/v1/network/backend/route_entry/create" httpMethod='POST'>
                <inputParameters>
                    <parameter datatype="string" mappingType="entity" required="N">id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">name</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">provider_id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">vpc_id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">destination</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">route_table_id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">next_type</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">next_hub</parameter>
                    <parameter datatype="string" mappingType="entity" required="N">zone</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">region</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">result</parameter>
                    <parameter datatype="string">errorMessage</parameter>
                    <parameter datatype="string">errorCode</parameter>
                </outputParameters>
            </interface>
            <interface action="delete" path="/terraform/v1/network/backend/route_entry/delete" httpMethod='POST'>
                <inputParameters>
                    <parameter datatype="string" mappingType="entity" required="Y">id</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">result</parameter>
                    <parameter datatype="string">errorMessage</parameter>
                    <parameter datatype="string">errorCode</parameter>
                </outputParameters>
            </interface>
        </plugin>
        <plugin name="security_group">
            <interface action="create" path="/terraform/v1/network/backend/security_group/create" httpMethod='POST'>
                <inputParameters>
                    <parameter datatype="string" mappingType="entity" required="N">id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">name</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">provider_id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">vpc_id</parameter>
                    <parameter datatype="string" mappingType="entity" required="N">zone</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">region</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">result</parameter>
                    <parameter datatype="string">errorMessage</parameter>
                    <parameter datatype="string">errorCode</parameter>
                </outputParameters>
            </interface>
            <interface action="delete" path="/terraform/v1/network/backend/security_group/delete" httpMethod='POST'>
                <inputParameters>
                    <parameter datatype="string" mappingType="entity" required="Y">id</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">result</parameter>
                    <parameter datatype="string">errorMessage</parameter>
                    <parameter datatype="string">errorCode</parameter>
                </outputParameters>
            </interface>
        </plugin>
        <plugin name="security_group_rule">
            <interface action="create" path="/terraform/v1/network/backend/security_group_rule/create" httpMethod='POST'>
                <inputParameters>
                    <parameter datatype="string" mappingType="entity" required="Y">id</parameter>
                    <parameter datatype="string" mappingType="entity" required="N">name</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">provider_id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">security_group_id</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">zone</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">region</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">type</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">cidr_ip</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">ip_protocol</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">ports</parameter>
                    <parameter datatype="string" mappingType="entity" required="Y">policy</parameter>
                    <parameter datatype="string" mappingType="entity" required="N">description</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">result</parameter>
                    <parameter datatype="string">errorMessage</parameter>
                    <parameter datatype="string">errorCode</parameter>
                </outputParameters>
            </interface>
            <interface action="delete" path="/terraform/v1/network/backend/security_group/delete" httpMethod='POST'>
                <inputParameters>
                    <parameter datatype="string" mappingType="entity" required="Y">id</parameter>
                </inputParameters>
                <outputParameters>
                    <parameter datatype="string">result</parameter>
                    <parameter datatype="string">errorMessage</parameter>
                    <parameter datatype="string">errorCode</parameter>
                </outputParameters>
            </interface>
        </plugin>
    </plugins>
</package>
